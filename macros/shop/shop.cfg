
{./shop_template.cfg}
{./get_menu.cfg}
{./get_item.cfg}

#undef CWD_MENU_SHOP
#define CWD_MENU_SHOP
[set_menu_item]
	id=cw_menu_10_shop
	description=$cw_text.shop_enter
	[filter_location]
		x="$cw_shop.$side_number|.x"
		y="$cw_shop.$side_number|.y"
		[/filter_location]
	[show_if]
		[have_unit]
			side=$side_number
			canrecruit=yes
			x=$x1
			y=$y1
			[/have_unit]
		[/show_if]
	[command]
	##	Begin menu
		{CWD_SHOP_MENU_WHILE root main}
			{CLEAR_VARIABLE cw_shop_menu}
			{VARIABLE cw_shop_menu.speaker narrator}
			{VARIABLE cw_shop_menu.side_for $side_number}
			{VARIABLE cw_shop_menu.message "$cw_text.display_gold: $gold|"}
			{CWD_ARRAY_APPEND cw_shop_menu.option ({CWD_SHOP_SUBMENU_EXIT root main $cw_text.shop_leave})}
			{CWD_ARRAY_APPEND cw_shop_menu.option (message= " ")}
			{FOREACH cw_items.types i}
				[set_variables]
					name=cw_shop_menu.option
					mode=append
					[value]
						message="&$cw_items.$cw_items.types[$i].name|.menu_image|=$cw_items.$cw_items.types[$i].name|.title"
						[command]
							{CWD_FIRE cw_shop_event_get_menu (parent_menu=main
							item_type=$cw_items.types[$i].name|)}
							[/command]
						[/value]
					[/set_variables]
				{NEXT i}
			[insert_tag]
				name=message
				variable=cw_shop_menu
				[/insert_tag]
			{CLEAR_VARIABLE cw_shop_menu}
			[/do]
			[/while]
		{CLEAR_VARIABLE menu_finished_main,menu_finished_root,cw_hero_in_shop}

		[lua]
			code = {~add-ons/{CREEPWARS_DIR}/lua/leader_ability.lua}
		[/lua]

		[/command]
	[/set_menu_item]
#enddef

#undef CWD_SHOP_POS_INIT
#define CWD_SHOP_POS_INIT SHOP_VAR SIDES X_POS Y_POS
	{CLEAR_VARIABLE tmp_sides}
	{CWD_ARRAY_COMMA tmp_sides {SIDES}}
	{FOREACH tmp_sides i}
		{VARIABLE {SHOP_VAR}.$tmp_sides[$i].value|.x {X_POS}}
		{VARIABLE {SHOP_VAR}.$tmp_sides[$i].value|.y {Y_POS}}
		{NEXT i}
	{CLEAR_VARIABLE tmp_sides}
#enddef

#undef CWD_SHOP_GUARD_NAME_INIT
#define CWD_SHOP_GUARD_NAME_INIT SHOP_VAR SIDES GUARD_1_NAME GUARD_2_NAME
	{CLEAR_VARIABLE tmp_sides}
	{CWD_ARRAY_COMMA tmp_sides {SIDES}}
	{FOREACH tmp_sides i}
		{VARIABLE {SHOP_VAR}.$tmp_sides[$i].value|.guard.1.name {GUARD_1_NAME}}
		{VARIABLE {SHOP_VAR}.$tmp_sides[$i].value|.guard.2.name {GUARD_2_NAME}}
		{NEXT i}
	{CLEAR_VARIABLE tmp_sides}
#enddef

#undef CWD_EVENTS_SHOP
#define CWD_EVENTS_SHOP
	{CWD_SHOP_EVENT_GET_MENU}
	{CWD_SHOP_EVENT_GET_ITEM}
#enddef
